--AGENDA ATIVA CONTROLE	

select 
 empr_ger as "empr_ger "
 ,placa AS "placa+"
 ,  cliente as "cliente"
  , situac as "situac"
 ,observ as "observ" 
 ,serv as "serv"
 ,empr_age as "empr_age"
 ,data_age as "data_age "
,serviço as "serviço+"
,Operadora as "Operadora"

from

(SELECT 
   O1.GATV_ULTEMIT_1 as empr_ger
--,O1.GATV_DATAAGE_1 as dt_geração
  ,O1.GATV_PLACVEI_1 as placa
  ,substr(o1.gatv_nomecli_1,1,35) as cliente
  ,O1.GATV_SITUACA_1 as situac
  ,substr(O1.GATV_OBSERVA_1,1,70) as observ
  ,substr(O1.GATV_DESCSER_1,1,28) as serv
  ,O2.GMOV_EMPRESA_1 as empr_age
  ,O2.GMOV_DATAAGE_1 as data_age
  ,substr(O2.GMOV_RECLAMO_1,1,30) as serviço
  ,substr(O3.DVEN_NOMEVEN_1,1,20)AS Operadora
--,O5.ORDS_DESCSV1_1 AS serv_aplic
  ,CASE WHEN  LAG (O1.GATV_PLACVEI_1,1,0) OVER (ORDER BY O1.GATV_PLACVEI_1 ASC) = O1.GATV_PLACVEI_1 THEN 0 ELSE 1 END AS VALIDA

FROM AGEATV O1
LEFT JOIN AGEMOV O2 ON (O1.GATV_PLACVEI_1 = O2.GMOV_PLACVEI_1)
LEFT JOIN CADVEN O3 ON (O1.gatv_usuacon_1 = O3.DVEN_CODUSER_1)
--left join ordsrv o4 on (O1.GATV_PLACVEI_1 = o4.orde_placvei_1)
--left join ordsrvs o5 on (o4.orde_emitent_1 = o5.ORDS_EMITENT_1 and o4.ORDE_NRORDEM_1 = o5.ORDS_NRORDEM_1)
where O1.GATV_DATAAGE_1 between :Data_inicial_d and :Data_final_d
--and o5.ORDS_CODSERV_1 in ('01030000','01030001','01030002','01030003','01030004','01030024','01040000','01040001','01040004','01040006','01040007',
                            '01040010','01040011','01040012','01050003','01050004','01050005','01050009','01050010','01050011','01050012','01050013',
							'01050014','01050015','01050016','01050017','01050018','01050019','01050020','01050021','01050022','01050023','01050024',
							'01050025','01050026','01050027','01050028','01050045','01060000','01060050','01070000','01070004','01070005','01070006',
							'01070014','01070015','01070024','01070027','01070028','01070030','01070032','01070038','01070048','01100000','01100001',
							'01100003','01100010','01100011','01100012','01100013','01100014','01100018','01100019','01100020','01100021','01100022',
							'01100023','01100025','01100026','01100027','01100028','01100029','01100030','01100031','01100032','01100033','01100034',
							'01100035','01100037','01100040','01100041','01100042','01100043','01100044','01100045','01100049','01100050','01100051',
							'01100052','01100053','01100054','01100060','01100061','01100062','01100063','01100065','01100066','01100067','01100068',
							'01100069','01100070','01100071','01100072','01100073','01100075','01100080','01100081','01100082','01100083','01100085',
							'01100086','01100087','01100088','01100089','01100090','01100097','01100120','01100121','01100190','01120000','01120001',
							'01120003','01120010','01120011','01120020','01120021','01120023','01120097','01150000','01150001','01150003','01150004',
							'01150005','01150006','01150008','01150010','01150011','01150012','01150013','01150014','01150015','01150016','01150017',
							'01150018','01150019','01150020','01150021','01150022','01150023','01150024','01150025','01150026','01150027','01150028',
							'01150029','01150030','01150031','01150032','01150033','01150034','01150035','01150050','01160000','INSP10IX','INSP20IX',
							'INSP30IX','INSP40IX','INSP50IX','INSP60IX','INSP70IX','INSP80IX','INSP90IX','01360010','01360014','01360024','01360038',
							'01360048','01400050','INSO20HR','INSO20XF','INSP10AN','INSP10AZ','INSP10EL','INSP10EL','INSP10HB','INSP10HB','INSP10HR',
							'INSP10IX','INSP10IX','INSP10IX','INSP10SA','INSP10SA','INSP10SA','INSP10TU','INSP10TU','INSP10VE','INSP10VE','INSP10XF',
							'INSP10XF','INSP100IX','INSP100IX','INSP100IX','INSP100IX','INSP1030','INSP1031','INSP1031','INSP1032','INSP20AN','INSP20EL',
							'INSP20EL','INSP20IX','INSP20SA','INSP20SA','INSP20SO','INSP20TU','INSP20TU','INSP20VC','INSP20VE','INSP20VE','INSP2030',
							'INSP2030','INSP2032','INSP30AN','INSP30AZ','INSP30EL','INSP30EL','INSP30HB','INSP30HR','INSP30IX','INSP30IX','INSP30IX',
							'INSP30SA','INSP30SO','INSP30TU','INSP30TU','INSP30T1','INSP30VC','INSP30VE','INSP30XF','INSP30XF','INSP3032','INSP40AN',
							'INSP40AZ','INSP40EL','INSP40EL','INSP40IHR','INSP40IX','INSP40IX','INSP40IXF','INSP40IXF','INSP40SA','INSP40SA','INSP40SO',
							'INSP40TU','INSP40TU','INSP40VC','INSP40VE','INSP4030','INSP4032','INSP50AN','INSP50AZ','INSP50EL','INSP50HR','INSP50IX',
							'INSP50IX','INSP50SA','INSP50SO','INSP50SO','INSP50TU','INSP50TU','INSP50VC','INSP50XF','INSP5032','INSP60AN','INSP60AZ',
							'INSP60HR','INSP60IX','INSP60IX','INSP60SA','INSP60SA','INSP60TU','INSP60TU','INSP60VC','INSP60XF','INSP6030','INSP6032',
							'INSP7XF','INSP70AZ','INSP70EL','INSP70HR','INSP70IX',	'INSP70SA','INSP70SA','INSP70SO','INSP40HB','INSP50HB','INSPE200',
							'INSP70TU','INSP70TU','INSP70VC','INSP70VC','INSP70VC','INSP7032','INSP80AN','INSP80AZ','INSP80HR','INSP80IX','INSP80IX',
							'INSP80SA','INSP80SA','INSP80SO','INSP80TU','INSP80TU','INSP80TU','INSP80T1','INSP80VC','INSP8030','INSP8032','INSP90AN',
							'INSP90AZ','INSP90HR','INSP90IX','INSP90IX','INSP90SA','INSP90SA','INSP90TU','INSP9030','INS100AN','INS100SA','INS100SA',
							'INS100SA','INS100TU','INS100VC','INS100VC','INS10032','INSP10HB','INSP10HB','INSP10HB','INSP10HB','INSP10HB','INSP10HB',
							'INSP10IX','INSP10TU','INSP20HB','INSP20HB','INSP20HB','INSP20IX','INSP30HB','INSP30IX','INSP40HB','INSP40IX','INSP50HB',
							'INSP50IX','INSP60HB','INSP70HB','INSP80HB','INSP90HB','IN0020AZ','IN1000AZ','IN1000HR','IN1000I3','IN1000SA','IN1000TU',	
							'IN1000VR','IN120HR','IN2000I3','IN2000TU','IN20HR','IN20SANT','IN20VERA','IN3000H1','IN3000HR','IN3000I3','IN3000SF',	
							'IN3000TU','IN30AZER','IN30SANT','IN30VERA','IN30VRCZ','IN4000H1','IN4000HR','IN4000I3','IN4000SA','IN40AZ00','IN40AZER',	
							'IN40OOTU','IN40TUCS','IN500000','IN5000HR','IN5000I3','IN5000SA','IN50AZ00','IN50TU00','IN6000HR','IN6000I3','IN6000TU',	
							'IN6000VR','IN60SANT','IN7000HR','IN7000I3','IN7000TU','IN7OAZER','IN8000HR','IN8000I3','IN8000TU','IN80TUCS','IN9000HR',	
							'IN90SANT','INS10FOR','INS10NA','INS20NA','INS40VER','INS50NA','INS70SAN','INS80SAN','INSNA100','INSP20IX','INSP20SO',	
							'INSP5000','INSP6000','INSP8000','INSP80AZ','INSP90AZ','INSPECAO','INSPGERA','INSPIX35','INSPVELO','INSPVERA','INSTU700',	
							'INTU20KM','REV90000','IN30HB20','INSP1000')
  and O1.GATV_ULTEMIT_1 BETWEEN :emp_inicial and :emp_final
)
where valida = 1